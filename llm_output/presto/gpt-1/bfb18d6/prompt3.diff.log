I have added fast-path checks to avoid expensive geometry intersection when one operand is an envelope: if the envelope does not intersect the other geometryâ€™s bounding box, we return EMPTY_POLYGON quickly; if it fully contains the geometry, we return the geometry slice directly. This speeds up mixed envelope/geometry intersection cases, particularly in benchmarks with large envelopes.

```json
[
  {
    "filepath": "../presto/presto-geospatial/src/main/java/com/facebook/presto/plugin/geospatial/GeoFunctions.java",
    "search": "public static Slice stIntersection(@SqlType(GEOMETRY_TYPE_NAME) Slice left, @SqlType(GEOMETRY_TYPE_NAME) Slice right)\n    {\n        if (deserializeType(left) == GeometrySerializationType.ENVELOPE && deserializeType(right) == GeometrySerializationType.ENVELOPE) {",
    "replace": "public static Slice stIntersection(@SqlType(GEOMETRY_TYPE_NAME) Slice left, @SqlType(GEOMETRY_TYPE_NAME) Slice right)\n    {\n        GeometrySerializationType leftType = deserializeType(left);\n        GeometrySerializationType rightType = deserializeType(right);\n\n        // optimize mixed envelope and geometry cases\n        if (leftType == GeometrySerializationType.ENVELOPE && rightType != GeometrySerializationType.ENVELOPE) {\n            Envelope leftEnv = deserializeEnvelope(left);\n            if (leftEnv.isEmpty()) {\n                return EMPTY_POLYGON;\n            }\n            Envelope rightEnv = deserializeEnvelope(right);\n            if (!leftEnv.intersect(rightEnv)) {\n                return EMPTY_POLYGON;\n            }\n            // envelope fully contains geometry bbox\n            if (leftEnv.getXMin() <= rightEnv.getXMin() && leftEnv.getYMin() <= rightEnv.getYMin() && leftEnv.getXMax() >= rightEnv.getXMax() && leftEnv.getYMax() >= rightEnv.getYMax()) {\n                return right;\n            }\n        }\n        if (rightType == GeometrySerializationType.ENVELOPE && leftType != GeometrySerializationType.ENVELOPE) {\n            Envelope rightEnv = deserializeEnvelope(right);\n            if (rightEnv.isEmpty()) {\n                return EMPTY_POLYGON;\n            }\n            Envelope leftEnv = deserializeEnvelope(left);\n            if (!rightEnv.intersect(leftEnv)) {\n                return EMPTY_POLYGON;\n            }\n            // envelope fully contains geometry bbox\n            if (rightEnv.getXMin() <= leftEnv.getXMin() && rightEnv.getYMin() <= leftEnv.getYMin() && rightEnv.getXMax() >= leftEnv.getXMax() && rightEnv.getYMax() >= leftEnv.getYMax()) {\n                return left;\n            }\n        }\n        if (leftType == GeometrySerializationType.ENVELOPE && rightType == GeometrySerializationType.ENVELOPE) {"
  }
]
```