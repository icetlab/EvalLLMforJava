diff --git a/presto-main/src/main/java/com/facebook/presto/operator/WindowOperator.java b/presto-main/src/main/java/com/facebook/presto/operator/WindowOperator.java
index 6813ba04fa..52ea2f860a 100644
--- a/presto-main/src/main/java/com/facebook/presto/operator/WindowOperator.java
+++ b/presto-main/src/main/java/com/facebook/presto/operator/WindowOperator.java
@@ -539,19 +539,20 @@ public class WindowOperator
             }
 
             boolean finishing = !pendingInputOptional.isPresent();
+            Page page = finishing ? null : pendingInputOptional.get();
+            int positionCount = finishing ? -1 : page.getPositionCount();
             if (finishing && pagesIndexWithHashStrategies.pagesIndex.getPositionCount() == 0) {
                 memoryContext.close();
                 return TransformationState.finished();
             }
 
             if (!finishing) {
-                Page pendingInput = pendingInputOptional.get();
-                pendingInputPosition = updatePagesIndex(pagesIndexWithHashStrategies, pendingInput, pendingInputPosition, Optional.empty());
+                pendingInputPosition = updatePagesIndex(pagesIndexWithHashStrategies, page, pendingInputPosition, Optional.empty());
                 updateMemoryUsage();
             }
 
             // If we have unused input or are finishing, then we have buffered a full group
-            if (finishing || pendingInputPosition < pendingInputOptional.get().getPositionCount()) {
+            if (finishing || pendingInputPosition < positionCount) {
                 sortPagesIndexIfNecessary(pagesIndexWithHashStrategies, orderChannels, ordering);
                 resetPagesIndex = true;
                 return TransformationState.ofResult(pagesIndexWithHashStrategies, false);
