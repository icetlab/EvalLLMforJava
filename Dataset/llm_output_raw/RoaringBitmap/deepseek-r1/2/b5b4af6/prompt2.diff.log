Looking at the test failure, the issue is in the `basic()` test where it expects cardinality 65535 but gets 65536. This indicates a problem with the cardinality caching logic I introduced. The test is running a comprehensive sequence of operations and our caching approach is not correctly tracking cardinality in all cases.

The fundamental issue is that maintaining a separate cached cardinality field introduces complexity and synchronization problems. Instead, I should optimize the existing `getCardinality()` method to be more efficient while keeping it computed on-demand.

Current `getCardinality()` iterates through all runs and sums lengths. This can be optimized by:
1. Using direct array access instead of method calls
2. Adding a fast path for common cases
3. Using loop unrolling or vectorization techniques

Here's a better approach: optimize the computation without caching to avoid synchronization issues.

```json
[
  {
    "filepath": "../RoaringBitmap/RoaringBitmap/src/main/java/org/roaringbitmap/RunContainer.java",
    "search": "  @Override\n  public int getCardinality() {\n    int sum = nbrruns;// lengths are returned -1\n    for (int k = 0; k < nbrruns; ++k) {\n      sum = sum + (getLength(k))/* + 1 */;\n    }\n    return sum;\n  }",
    "replace": "  @Override\n  public int getCardinality() {\n    int sum = nbrruns;\n    // Direct array access for better performance\n    char[] vl = valueslength;\n    for (int k = 0; k < nbrruns; ++k) {\n      sum += (vl[2 * k + 1] & 0xFFFF);\n    }\n    return sum;\n  }"
  },
  {
    "filepath": "../RoaringBitmap/RoaringBitmap/src/main/java/org/roaringbitmap/buffer/MappeableRunContainer.java",
    "search": "  @Override\n  public int getCardinality() {\n    int sum = nbrruns; // lengths are stored -1\n    if (isArrayBacked()) {\n      char[] vl = valueslength.array();\n      for (int k = 0; k < nbrruns; ++k) {\n        sum = sum + (vl[2 * k + 1])/* + 1 */;\n      }\n    } else {\n      for (int k = 0; k < nbrruns; ++k) {\n        sum = sum + (getLength(k))/* + 1 */;\n      }\n    }\n    return sum;\n  }",
    "replace": "  @Override\n  public int getCardinality() {\n    int sum = nbrruns;\n    if (isArrayBacked()) {\n      // Direct array access for better performance\n      char[] vl = valueslength.array();\n      for (int k = 0; k < nbrruns; ++k) {\n        sum += (vl[2 * k + 1] & 0xFFFF);\n      }\n    } else {\n      for (int k = 0; k < nbrruns; ++k) {\n        sum += (getLength(k) & 0xFFFF);\n      }\n    }\n    return sum;\n  }"
  }
]
```