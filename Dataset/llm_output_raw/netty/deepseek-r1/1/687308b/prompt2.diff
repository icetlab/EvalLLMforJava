diff --git a/codec-http/src/main/java/io/netty/handler/codec/http/QueryStringEncoder.java b/codec-http/src/main/java/io/netty/handler/codec/http/QueryStringEncoder.java
index da5080ff85..fa444ef224 100644
--- a/codec-http/src/main/java/io/netty/handler/codec/http/QueryStringEncoder.java
+++ b/codec-http/src/main/java/io/netty/handler/codec/http/QueryStringEncoder.java
@@ -120,31 +120,63 @@ public class QueryStringEncoder {
      * @param s The String to encode
      */
     private void encodeNonUtf8Component(CharSequence s) {
-        //Don't allocate memory until needed
+        int len = s.length();
+        int safeStart = 0;
         char[] buf = null;
-
-        for (int i = 0, len = s.length(); i < len;) {
+        int bufIndex = 0;
+        
+        for (int i = 0; i < len; i++) {
             char c = s.charAt(i);
             if (dontNeedEncoding(c)) {
-                uriBuilder.append(c);
-                i++;
-            } else {
-                int index = 0;
-                if (buf == null) {
-                    buf = new char[s.length() - i];
-                }
-
-                do {
-                    buf[index] = c;
-                    index++;
-                    i++;
-                } while (i < s.length() && !dontNeedEncoding(c = s.charAt(i)));
-
-                byte[] bytes = new String(buf, 0, index).getBytes(charset);
-
-                for (byte b : bytes) {
-                    appendEncoded(b);
+                // Track safe characters for batch appending
+                if (bufIndex > 0) {
+                    // We have pending encoded characters, flush them first
+                    byte[] bytes = new String(buf, 0, bufIndex).getBytes(charset);
+                    for (byte b : bytes) {
+                        appendEncoded(b);
+                    }
+                    bufIndex = 0;
                 }
+                continue;
+            }
+            
+            // Append any preceding safe characters as batch
+            if (i > safeStart) {
+                uriBuilder.append(s, safeStart, i);
+            }
+            
+            // Initialize buffer if needed
+            if (buf == null) {
+                buf = new char[len - i];
+            }
+            
+            // Collect characters needing encoding
+            bufIndex = 0;
+            do {
+                buf[bufIndex++] = c;
+                i++;
+            } while (i < len && !dontNeedEncoding(c = s.charAt(i)));
+            
+            // Process collected characters
+            byte[] bytes = new String(buf, 0, bufIndex).getBytes(charset);
+            for (byte b : bytes) {
+                appendEncoded(b);
+            }
+            
+            safeStart = i;
+            i--; // Adjust for loop increment
+        }
+        
+        // Append any remaining safe characters
+        if (safeStart < len) {
+            uriBuilder.append(s, safeStart, len);
+        }
+        
+        // Handle any remaining encoded characters in buffer
+        if (bufIndex > 0) {
+            byte[] bytes = new String(buf, 0, bufIndex).getBytes(charset);
+            for (byte b : bytes) {
+                appendEncoded(b);
             }
         }
     }
@@ -153,35 +185,59 @@ public class QueryStringEncoder {
      * @see ByteBufUtil#writeUtf8(io.netty.buffer.ByteBuf, CharSequence, int, int)
      */
     private void encodeUtf8Component(CharSequence s) {
-        for (int i = 0, len = s.length(); i < len; i++) {
+        int len = s.length();
+        int safeStart = 0;
+        for (int i = 0; i < len; i++) {
             char c = s.charAt(i);
             if (c < 0x80) {
                 if (dontNeedEncoding(c)) {
-                    uriBuilder.append(c);
-                } else {
-                    appendEncoded(c);
-                }
-            } else if (c < 0x800) {
-                appendEncoded(0xc0 | (c >> 6));
-                appendEncoded(0x80 | (c & 0x3f));
-            } else if (StringUtil.isSurrogate(c)) {
-                if (!Character.isHighSurrogate(c)) {
-                    appendEncoded(WRITE_UTF_UNKNOWN);
                     continue;
                 }
-                // Surrogate Pair consumes 2 characters.
-                if (++i == s.length()) {
-                    appendEncoded(WRITE_UTF_UNKNOWN);
-                    break;
+                // Append safe characters as a batch
+                if (i > safeStart) {
+                    uriBuilder.append(s, safeStart, i);
                 }
-                // Extra method to allow inlining the rest of writeUtf8 which is the most likely code path.
-                writeUtf8Surrogate(c, s.charAt(i));
+                // Encode the current character
+                appendEncoded(c);
+                safeStart = i + 1;
             } else {
-                appendEncoded(0xe0 | (c >> 12));
-                appendEncoded(0x80 | ((c >> 6) & 0x3f));
-                appendEncoded(0x80 | (c & 0x3f));
+                // Append any preceding safe characters
+                if (i > safeStart) {
+                    uriBuilder.append(s, safeStart, i);
+                }
+                if (c < 0x800) {
+                    appendEncoded(0xc0 | (c >> 6));
+                    appendEncoded(0x80 | (c & 0x3f));
+                } else if (StringUtil.isSurrogate(c)) {
+                    if (!Character.isHighSurrogate(c)) {
+                        appendEncoded(WRITE_UTF_UNKNOWN);
+                    } else {
+                        // Surrogate Pair consumes 2 characters
+                        if (i + 1 == len) {
+                            appendEncoded(WRITE_UTF_UNKNOWN);
+                        } else {
+                            char c2 = s.charAt(i + 1);
+                            if (!Character.isLowSurrogate(c2)) {
+                                appendEncoded(WRITE_UTF_UNKNOWN);
+                                appendEncoded(WRITE_UTF_UNKNOWN);
+                            } else {
+                                writeUtf8Surrogate(c, c2);
+                                i++; // Skip the second character of surrogate pair
+                            }
+                        }
+                    }
+                } else {
+                    appendEncoded(0xe0 | (c >> 12));
+                    appendEncoded(0x80 | ((c >> 6) & 0x3f));
+                    appendEncoded(0x80 | (c & 0x3f));
+                }
+                safeStart = i + 1;
             }
         }
+        // Append any remaining safe characters
+        if (safeStart < len) {
+            uriBuilder.append(s, safeStart, len);
+        }
     }
 
     private void writeUtf8Surrogate(char c, char c2) {
