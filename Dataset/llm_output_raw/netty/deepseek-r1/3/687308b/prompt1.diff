diff --git a/codec-http/src/main/java/io/netty/handler/codec/http/QueryStringEncoder.java b/codec-http/src/main/java/io/netty/handler/codec/http/QueryStringEncoder.java
index da5080ff85..bef7ccc1da 100644
--- a/codec-http/src/main/java/io/netty/handler/codec/http/QueryStringEncoder.java
+++ b/codec-http/src/main/java/io/netty/handler/codec/http/QueryStringEncoder.java
@@ -120,68 +120,80 @@ public class QueryStringEncoder {
      * @param s The String to encode
      */
     private void encodeNonUtf8Component(CharSequence s) {
-        //Don't allocate memory until needed
-        char[] buf = null;
-
-        for (int i = 0, len = s.length(); i < len;) {
+        final int len = s.length();
+        int start = 0;
+        int i = 0;
+        
+        for (; i < len; i++) {
             char c = s.charAt(i);
-            if (dontNeedEncoding(c)) {
-                uriBuilder.append(c);
-                i++;
-            } else {
-                int index = 0;
-                if (buf == null) {
-                    buf = new char[s.length() - i];
+            if (!dontNeedEncoding(c)) {
+                if (start < i) {
+                    uriBuilder.append(s, start, i);
                 }
-
-                do {
-                    buf[index] = c;
-                    index++;
-                    i++;
-                } while (i < s.length() && !dontNeedEncoding(c = s.charAt(i)));
-
-                byte[] bytes = new String(buf, 0, index).getBytes(charset);
-
+                // Encode the current character
+                byte[] bytes = String.valueOf(c).getBytes(charset);
                 for (byte b : bytes) {
                     appendEncoded(b);
                 }
+                start = i + 1;
             }
         }
+        
+        if (start < i) {
+            uriBuilder.append(s, start, i);
+        }
     }
 
     /**
      * @see ByteBufUtil#writeUtf8(io.netty.buffer.ByteBuf, CharSequence, int, int)
      */
     private void encodeUtf8Component(CharSequence s) {
-        for (int i = 0, len = s.length(); i < len; i++) {
+        final int len = s.length();
+        int start = 0;
+        int i = 0;
+        
+        for (; i < len; i++) {
             char c = s.charAt(i);
             if (c < 0x80) {
-                if (dontNeedEncoding(c)) {
-                    uriBuilder.append(c);
-                } else {
+                if (!dontNeedEncoding(c)) {
+                    if (start < i) {
+                        uriBuilder.append(s, start, i);
+                    }
                     appendEncoded(c);
+                    start = i + 1;
                 }
-            } else if (c < 0x800) {
-                appendEncoded(0xc0 | (c >> 6));
-                appendEncoded(0x80 | (c & 0x3f));
-            } else if (StringUtil.isSurrogate(c)) {
-                if (!Character.isHighSurrogate(c)) {
-                    appendEncoded(WRITE_UTF_UNKNOWN);
-                    continue;
+            } else {
+                if (start < i) {
+                    uriBuilder.append(s, start, i);
                 }
-                // Surrogate Pair consumes 2 characters.
-                if (++i == s.length()) {
-                    appendEncoded(WRITE_UTF_UNKNOWN);
-                    break;
+                start = i + 1;
+                
+                if (c < 0x800) {
+                    appendEncoded(0xc0 | (c >> 6));
+                    appendEncoded(0x80 | (c & 0x3f));
+                } else if (StringUtil.isSurrogate(c)) {
+                    if (!Character.isHighSurrogate(c)) {
+                        appendEncoded(WRITE_UTF_UNKNOWN);
+                        continue;
+                    }
+                    // Surrogate Pair consumes 2 characters.
+                    if (++i == len) {
+                        appendEncoded(WRITE_UTF_UNKNOWN);
+                        break;
+                    }
+                    writeUtf8Surrogate(c, s.charAt(i));
+                    start = i + 1;
+                } else {
+                    appendEncoded(0xe0 | (c >> 12));
+                    appendEncoded(0x80 | ((c >> 6) & 0x3f));
+                    appendEncoded(0x80 | (c & 0x3f));
                 }
-                // Extra method to allow inlining the rest of writeUtf8 which is the most likely code path.
-                writeUtf8Surrogate(c, s.charAt(i));
-            } else {
-                appendEncoded(0xe0 | (c >> 12));
-                appendEncoded(0x80 | ((c >> 6) & 0x3f));
-                appendEncoded(0x80 | (c & 0x3f));
             }
         }
+        
+        if (start < i) {
+            uriBuilder.append(s, start, i);
+        }
     }
 
     private void writeUtf8Surrogate(char c, char c2) {
@@ -199,7 +211,7 @@ public class QueryStringEncoder {
     }
 
     private void appendEncoded(int b) {
-        uriBuilder.append('%').append(forDigit(b >> 4)).append(forDigit(b));
+        uriBuilder.append('%').append(CHAR_MAP[(b >> 4) & 0xF]).append(CHAR_MAP[b & 0xF]);
     }
 
     /**
@@ -225,7 +237,12 @@ public class QueryStringEncoder {
      * @return true or false
      */
     private static boolean dontNeedEncoding(char ch) {
-        return ch >= 'a' && ch <= 'z' || ch >= 'A' && ch <= 'Z' || ch >= '0' && ch <= '9'
-                || ch == '-' || ch == '_' || ch == '.' || ch == '*';
+        if (ch <= 'Z') {
+            if (ch >= 'A') return true;
+            if (ch >= '0' && ch <= '9') return true;
+            return ch == '-' || ch == '.';
+        }
+        if (ch >= 'a' && ch <= 'z') return true;
+        return ch == '_' || ch == '*';
     }
 }
