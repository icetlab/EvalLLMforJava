diff --git a/buffer/src/main/java/io/netty/buffer/AbstractReferenceCountedByteBuf.java b/buffer/src/main/java/io/netty/buffer/AbstractReferenceCountedByteBuf.java
index e657ad86f8..27cbfc815c 100644
--- a/buffer/src/main/java/io/netty/buffer/AbstractReferenceCountedByteBuf.java
+++ b/buffer/src/main/java/io/netty/buffer/AbstractReferenceCountedByteBuf.java
@@ -101,9 +101,9 @@ public abstract class AbstractReferenceCountedByteBuf extends AbstractByteBuf {
             if (refCnt < decrement) {
                 throw new IllegalReferenceCountException(refCnt, -decrement);
             }
-
-            if (refCntUpdater.compareAndSet(this, refCnt, refCnt - decrement)) {
-                if (refCnt == decrement) {
+            int nextCnt = refCnt - decrement;
+            if (refCntUpdater.compareAndSet(this, refCnt, nextCnt)) {
+                if (nextCnt == 0) {
                     deallocate();
                     return true;
                 }
diff --git a/common/src/main/java/io/netty/util/AbstractReferenceCounted.java b/common/src/main/java/io/netty/util/AbstractReferenceCounted.java
index 493bcc1872..1c03e82825 100644
--- a/common/src/main/java/io/netty/util/AbstractReferenceCounted.java
+++ b/common/src/main/java/io/netty/util/AbstractReferenceCounted.java
@@ -88,9 +88,9 @@ public abstract class AbstractReferenceCounted implements ReferenceCounted {
             if (refCnt < decrement) {
                 throw new IllegalReferenceCountException(refCnt, -decrement);
             }
-
-            if (refCntUpdater.compareAndSet(this, refCnt, refCnt - decrement)) {
-                if (refCnt == decrement) {
+            int nextCnt = refCnt - decrement;
+            if (refCntUpdater.compareAndSet(this, refCnt, nextCnt)) {
+                if (nextCnt == 0) {
                     deallocate();
                     return true;
                 }
