diff --git a/buffer/src/main/java/io/netty/buffer/AbstractByteBuf.java b/buffer/src/main/java/io/netty/buffer/AbstractByteBuf.java
index c8c40a5d24..26c735e904 100644
--- a/buffer/src/main/java/io/netty/buffer/AbstractByteBuf.java
+++ b/buffer/src/main/java/io/netty/buffer/AbstractByteBuf.java
@@ -254,9 +254,10 @@ public abstract class AbstractByteBuf extends ByteBuf {
 
     protected final void adjustMarkers(int decrement) {
         int markedReaderIndex = this.markedReaderIndex;
+        int markedWriterIndex = this.markedWriterIndex;
+        
         if (markedReaderIndex <= decrement) {
             this.markedReaderIndex = 0;
-            int markedWriterIndex = this.markedWriterIndex;
             if (markedWriterIndex <= decrement) {
                 this.markedWriterIndex = 0;
             } else {
@@ -264,7 +265,7 @@ public abstract class AbstractByteBuf extends ByteBuf {
             }
         } else {
             this.markedReaderIndex = markedReaderIndex - decrement;
-            markedWriterIndex -= decrement;
+            this.markedWriterIndex = markedWriterIndex - decrement;
         }
     }
 
@@ -669,13 +670,24 @@ public abstract class AbstractByteBuf extends ByteBuf {
         }
         if (nBytes == 4) {
             _setInt(index, 0);
-            // Not need to update the index as we not will use it after this.
         } else if (nBytes < 4) {
-            for (int i = nBytes; i > 0; i --) {
-                _setByte(index, (byte) 0);
-                index ++;
+            // Use a switch for small cases
+            switch (nBytes) {
+                case 3:
+                    _setByte(index, (byte) 0);
+                    _setByte(index + 1, (byte) 0);
+                    _setByte(index + 2, (byte) 0);
+                    break;
+                case 2:
+                    _setByte(index, (byte) 0);
+                    _setByte(index + 1, (byte) 0);
+                    break;
+                case 1:
+                    _setByte(index, (byte) 0);
+                    break;
             }
         } else {
+            // nBytes is 5, 6, or 7
             _setInt(index, 0);
             index += 4;
             for (int i = nBytes - 4; i > 0; i --) {
@@ -1162,11 +1174,26 @@ public abstract class AbstractByteBuf extends ByteBuf {
             _setInt(wIndex, 0);
             wIndex += 4;
         } else if (nBytes < 4) {
-            for (int i = nBytes; i > 0; i --) {
-                _setByte(wIndex, (byte) 0);
-                wIndex++;
+            // Use a switch for small cases
+            switch (nBytes) {
+                case 3:
+                    _setByte(wIndex, (byte) 0);
+                    _setByte(wIndex + 1, (byte) 0);
+                    _setByte(wIndex + 2, (byte) 0);
+                    wIndex += 3;
+                    break;
+                case 2:
+                    _setByte(wIndex, (byte) 0);
+                    _setByte(wIndex + 1, (byte) 0);
+                    wIndex += 2;
+                    break;
+                case 1:
+                    _setByte(wIndex, (byte) 0);
+                    wIndex += 1;
+                    break;
             }
         } else {
+            // nBytes is 5, 6, or 7
             _setInt(wIndex, 0);
             wIndex += 4;
             for (int i = nBytes - 4; i > 0; i --) {
@@ -1290,12 +1317,12 @@ public abstract class AbstractByteBuf extends ByteBuf {
     }
 
     private int forEachByteAsc0(int start, int end, ByteProcessor processor) throws Exception {
-        for (; start < end; ++start) {
+        while (start < end) {
             if (!processor.process(_getByte(start))) {
                 return start;
             }
+            ++start;
         }
-
         return -1;
     }
 
@@ -1322,10 +1349,11 @@ public abstract class AbstractByteBuf extends ByteBuf {
     }
 
     private int forEachByteDesc0(int rStart, final int rEnd, ByteProcessor processor) throws Exception {
-        for (; rStart >= rEnd; --rStart) {
+        while (rStart >= rEnd) {
             if (!processor.process(_getByte(rStart))) {
                 return rStart;
             }
+            --rStart;
         }
         return -1;
     }
diff --git a/buffer/src/main/java/io/netty/buffer/AbstractReferenceCountedByteBuf.java b/buffer/src/main/java/io/netty/buffer/AbstractReferenceCountedByteBuf.java
index d624d855f4..4f610e2e97 100644
--- a/buffer/src/main/java/io/netty/buffer/AbstractReferenceCountedByteBuf.java
+++ b/buffer/src/main/java/io/netty/buffer/AbstractReferenceCountedByteBuf.java
@@ -61,8 +61,9 @@ public abstract class AbstractReferenceCountedByteBuf extends AbstractByteBuf {
 
     private ByteBuf retain0(final int increment) {
         int oldRef = refCntUpdater.getAndAdd(this, increment);
-        if (oldRef <= 0 || oldRef + increment < oldRef) {
-            // Ensure we don't resurrect (which means the refCnt was 0) and also that we encountered an overflow.
+        // Check for overflow and ensure we don't resurrect (refCnt was 0)
+        if (oldRef <= 0 || oldRef > Integer.MAX_VALUE - increment) {
+            // Rollback and throw
             refCntUpdater.getAndAdd(this, -increment);
             throw new IllegalReferenceCountException(oldRef, increment);
         }
@@ -94,8 +95,8 @@ public abstract class AbstractReferenceCountedByteBuf extends AbstractByteBuf {
         if (oldRef == decrement) {
             deallocate();
             return true;
-        } else if (oldRef < decrement || oldRef - decrement > oldRef) {
-            // Ensure we don't over-release, and avoid underflow.
+        } else if (oldRef < decrement) {
+            // Ensure we don't over-release
             refCntUpdater.getAndAdd(this, decrement);
             throw new IllegalReferenceCountException(oldRef, -decrement);
         }
