## Explanation of Performance Improvements

The main performance issue in `HttpRequestEncoder.encodeInitialLine` is the inefficient handling of URI normalization, particularly the string manipulation logic for adding a trailing slash. The current implementation uses `StringBuilder` and multiple indexOf/lastIndexOf calls, which can be optimized by reducing redundant operations and avoiding unnecessary object allocations.

Key improvements:
1. **Reduce redundant index calculations**: The code calls `uri.lastIndexOf(SLASH, index)` and `uri.lastIndexOf(SLASH) <= startIndex` multiple times with similar parameters. We can compute these once.
2. **Avoid StringBuilder allocation when not needed**: The StringBuilder is only needed when we have to insert a slash before query parameters. We can check if the slash insertion is actually required before creating it.
3. **Simplify logic flow**: The nested conditionals can be flattened for better readability and performance.

```json
[
  {
    "filepath": "../netty/codec-http/src/main/java/io/netty/handler/codec/http/HttpRequestEncoder.java",
    "search": "        // Add / as absolute path if no is present.\n        // See http://tools.ietf.org/html/rfc2616#section-5.1.2\n        String uri = request.uri();\n\n        if (uri.isEmpty()) {\n            uri += SLASH;\n        } else {\n            int start = uri.indexOf(\"://\");\n            if (start != -1 && uri.charAt(0) != SLASH) {\n                int startIndex = start + 3;\n                // Correctly handle query params.\n                // See https://github.com/netty/netty/issues/2732\n                int index = uri.indexOf(QUESTION_MARK, startIndex);\n                if (index == -1) {\n                    if (uri.lastIndexOf(SLASH) <= startIndex) {\n                        uri += SLASH;\n                    }\n                } else {\n                    if (uri.lastIndexOf(SLASH, index) <= startIndex) {\n                        int len = uri.length();\n                        StringBuilder sb = new StringBuilder(len + 1);\n                        sb.append(uri, 0, index)\n                          .append(SLASH)\n                          .append(uri, index, len);\n                        uri = sb.toString();\n                    }\n                }\n            }\n        }",
    "replace": "        // Add / as absolute path if no is present.\n        // See http://tools.ietf.org/html/rfc2616#section-5.1.2\n        String uri = request.uri();\n\n        if (uri.isEmpty()) {\n            uri += SLASH;\n        } else {\n            int start = uri.indexOf(\"://\");\n            if (start != -1 && uri.charAt(0) != SLASH) {\n                int startIndex = start + 3;\n                // Correctly handle query params.\n                // See https://github.com/netty/netty/issues/2732\n                int queryIndex = uri.indexOf(QUESTION_MARK, startIndex);\n                int lastSlashBeforeQuery = queryIndex == -1 \n                    ? uri.lastIndexOf(SLASH) \n                    : uri.lastIndexOf(SLASH, queryIndex);\n                \n                if (lastSlashBeforeQuery <= startIndex) {\n                    if (queryIndex == -1) {\n                        uri += SLASH;\n                    } else {\n                        // Only allocate StringBuilder when we actually need to insert\n                        StringBuilder sb = new StringBuilder(uri.length() + 1);\n                        sb.append(uri, 0, queryIndex)\n                          .append(SLASH)\n                          .append(uri, queryIndex, uri.length());\n                        uri = sb.toString();\n                    }\n                }\n            }\n        }"
  }
]
```