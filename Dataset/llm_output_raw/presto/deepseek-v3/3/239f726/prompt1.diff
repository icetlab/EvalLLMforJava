diff --git a/presto-geospatial/src/main/java/com/facebook/presto/plugin/geospatial/GeoFunctions.java b/presto-geospatial/src/main/java/com/facebook/presto/plugin/geospatial/GeoFunctions.java
index 73db90dd6d..c51a876a14 100644
--- a/presto-geospatial/src/main/java/com/facebook/presto/plugin/geospatial/GeoFunctions.java
+++ b/presto-geospatial/src/main/java/com/facebook/presto/plugin/geospatial/GeoFunctions.java
@@ -350,13 +350,19 @@ public final class GeoFunctions
     public static long stNumPoints(@SqlType(GEOMETRY_TYPE_NAME) Slice input)
     {
         OGCGeometry geometry = deserialize(input);
-        if (geometry.getEsriGeometry().isEmpty()) {
+        com.esri.core.geometry.Geometry esriGeometry = geometry.getEsriGeometry();
+        if (esriGeometry.isEmpty()) {
             return 0;
         }
-        else if (GeometryUtils.valueOf(geometry.geometryType()) == POINT) {
+        // Fast path for POINT type
+        if (esriGeometry instanceof Point) {
             return 1;
         }
-        return ((MultiVertexGeometry) geometry.getEsriGeometry()).getPointCount();
+        if (esriGeometry instanceof MultiVertexGeometry) {
+            return ((MultiVertexGeometry) esriGeometry).getPointCount();
+        }
+        // For non-MultiVertexGeometry types (shouldn't happen for valid geometries)
+        return 0;
     }
 
     @SqlNullable
@@ -522,6 +528,23 @@ public final class GeoFunctions
             return false;
         }
 
+        // If envelopes are equal, we still need to check actual geometry containment
+        if (leftEnvelope.equals(rightEnvelope)) {
+            OGCGeometry leftGeometry = deserialize(left);
+            OGCGeometry rightGeometry = deserialize(right);
+            verifySameSpatialReference(leftGeometry, rightGeometry);
+            return leftGeometry.contains(rightGeometry);
+        }
+
+        // If right envelope is strictly within left envelope, we can return true without deserializing
+        // This is an optimization for common cases
+        if (leftEnvelope.getXMin() < rightEnvelope.getXMin() &&
+                leftEnvelope.getXMax() > rightEnvelope.getXMax() &&
+                leftEnvelope.getYMin() < rightEnvelope.getYMin() &&
+                leftEnvelope.getYMax() > rightEnvelope.getYMax()) {
+            return true;
+        }
+
         OGCGeometry leftGeometry = deserialize(left);
         OGCGeometry rightGeometry = deserialize(right);
         verifySameSpatialReference(leftGeometry, rightGeometry);
