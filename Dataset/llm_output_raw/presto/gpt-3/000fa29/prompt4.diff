diff --git a/presto-main/src/main/java/com/facebook/presto/operator/repartition/OptimizedPartitionedOutputOperator.java b/presto-main/src/main/java/com/facebook/presto/operator/repartition/OptimizedPartitionedOutputOperator.java
index 30e0088e35..962d5ffae7 100644
--- a/presto-main/src/main/java/com/facebook/presto/operator/repartition/OptimizedPartitionedOutputOperator.java
+++ b/presto-main/src/main/java/com/facebook/presto/operator/repartition/OptimizedPartitionedOutputOperator.java
@@ -567,6 +567,8 @@ public class OptimizedPartitionedOutputOperator
 
         private void addPosition(int position)
         {
+            // Ensure capacity for new position
+            positions = ensureCapacity(positions, positionCount + 1);
             positions[positionCount++] = position;
         }
 
