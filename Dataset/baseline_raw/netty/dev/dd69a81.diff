commit dd69a813d46c2db2b8071445ecddb4bf939ba2e9
Author: Dmitriy Dumanskiy <doom369@gmail.com>
Date:   Wed Jun 14 15:09:28 2017 +0300

    Performance improvement for HttpRequestEncoder. Insert char into the string optimized.
    
    Motivation:
    
    Right now HttpRequestEncoder does insertion of slash for url like http://localhost?pararm=1 before the question mark. It is done not effectively.
    
    Modification:
    
    Code:
    
    new StringBuilder(len + 1)
                    .append(uri, 0, index)
                    .append(SLASH)
                    .append(uri, index, len)
                    .toString();
    Replaced with:
    
    new StringBuilder(uri)
                    .insert(index, SLASH)
                    .toString();
    Result:
    
    Faster HttpRequestEncoder. Additional small test. Attached benchmark in PR.
    
    Benchmark                                      Mode  Cnt        Score        Error  Units
    HttpRequestEncoderInsertBenchmark.newEncoder  thrpt   40  3704843.303 ±  98950.919  ops/s
    HttpRequestEncoderInsertBenchmark.oldEncoder  thrpt   40  3284236.960 ± 134433.217  ops/s

diff --git a/codec-http/src/main/java/io/netty/handler/codec/http/HttpRequestEncoder.java b/codec-http/src/main/java/io/netty/handler/codec/http/HttpRequestEncoder.java
index 0db8a4ce34..95e92100fe 100644
--- a/codec-http/src/main/java/io/netty/handler/codec/http/HttpRequestEncoder.java
+++ b/codec-http/src/main/java/io/netty/handler/codec/http/HttpRequestEncoder.java
@@ -58,12 +58,7 @@ public class HttpRequestEncoder extends HttpObjectEncoder<HttpRequest> {
                     }
                 } else {
                     if (uri.lastIndexOf(SLASH, index) <= startIndex) {
-                        int len = uri.length();
-                        StringBuilder sb = new StringBuilder(len + 1);
-                        sb.append(uri, 0, index)
-                          .append(SLASH)
-                          .append(uri, index, len);
-                        uri = sb.toString();
+                        uri = new StringBuilder(uri).insert(index, SLASH).toString();
                     }
                 }
             }
