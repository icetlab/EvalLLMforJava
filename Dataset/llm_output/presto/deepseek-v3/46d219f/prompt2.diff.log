The performance issue is to optimize `map_concat` to skip empty maps. Currently, the function always processes both input maps, even if one is empty. We can add early checks to avoid unnecessary work when either map is empty. If one map is empty, we can return the other map directly. If both are empty, we can return an empty map. This reduces allocations and iterations.

Additionally, we can optimize the case where the right map is empty by skipping the creation of the `TypedSet` and the first loop, and similarly when the left map is empty we can skip the second loop and just process the right map.

Here are the changes:

```json
[
  {
    "filepath": "../presto/presto-main/src/main/java/com/facebook/presto/operator/scalar/MapConcatFunction.java",
    "search": "    @TypeParameter(\"K\")\n    @TypeParameter(\"V\")\n    @SqlType(\"map(K,V)\")\n    public static Block mapConcat(\n            @TypeParameter(\"K\") Type keyType,\n            @TypeParameter(\"V\") Type valueType,\n            @SqlType(\"map(K,V)\") Block leftMap,\n            @SqlType(\"map(K,V)\") Block rightMap)\n    {\n        TypedSet typedSet = new TypedSet(keyType, rightMap.getPositionCount());\n        BlockBuilder blockBuilder = new InterleavedBlockBuilder(ImmutableList.of(keyType, valueType), new BlockBuilderStatus(), leftMap.getPositionCount() + rightMap.getPositionCount());\n        for (int i = 0; i < rightMap.getPositionCount(); i += 2) {\n            typedSet.add(rightMap, i);\n            keyType.appendTo(rightMap, i, blockBuilder);\n            valueType.appendTo(rightMap, i + 1, blockBuilder);\n        }\n        for (int i = 0; i < leftMap.getPositionCount(); i += 2) {\n            if (!typedSet.contains(leftMap, i)) {\n                keyType.appendTo(leftMap, i, blockBuilder);\n                valueType.appendTo(leftMap, i + 1, blockBuilder);\n            }\n        }\n        return blockBuilder.build();\n    }",
    "replace": "    @TypeParameter(\"K\")\n    @TypeParameter(\"V\")\n    @SqlType(\"map(K,V)\")\n    public static Block mapConcat(\n            @TypeParameter(\"K\") Type keyType,\n            @TypeParameter(\"V\") Type valueType,\n            @SqlType(\"map(K,V)\") Block leftMap,\n            @SqlType(\"map(K,V)\") Block rightMap)\n    {\n        int leftPositionCount = leftMap.getPositionCount();\n        int rightPositionCount = rightMap.getPositionCount();\n        if (leftPositionCount == 0) {\n            return rightMap;\n        }\n        if (rightPositionCount == 0) {\n            return leftMap;\n        }\n        TypedSet typedSet = new TypedSet(keyType, rightPositionCount);\n        BlockBuilder blockBuilder = new InterleavedBlockBuilder(ImmutableList.of(keyType, valueType), new BlockBuilderStatus(), leftPositionCount + rightPositionCount);\n        for (int i = 0; i < rightPositionCount; i += 2) {\n            typedSet.add(rightMap, i);\n            keyType.appendTo(rightMap, i, blockBuilder);\n            valueType.appendTo(rightMap, i + 1, blockBuilder);\n        }\n        for (int i = 0; i < leftPositionCount; i += 2) {\n            if (!typedSet.contains(leftMap, i)) {\n                keyType.appendTo(leftMap, i, blockBuilder);\n                valueType.appendTo(leftMap, i + 1, blockBuilder);\n            }\n        }\n        return blockBuilder.build();\n    }"
  }
]
```