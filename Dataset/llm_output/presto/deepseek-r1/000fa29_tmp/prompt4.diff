diff --git a/presto-main/src/main/java/com/facebook/presto/operator/repartition/OptimizedPartitionedOutputOperator.java b/presto-main/src/main/java/com/facebook/presto/operator/repartition/OptimizedPartitionedOutputOperator.java
index 30e0088e35..af903ca5cb 100644
--- a/presto-main/src/main/java/com/facebook/presto/operator/repartition/OptimizedPartitionedOutputOperator.java
+++ b/presto-main/src/main/java/com/facebook/presto/operator/repartition/OptimizedPartitionedOutputOperator.java
@@ -559,14 +559,22 @@ public class OptimizedPartitionedOutputOperator
             this.lifespan = requireNonNull(lifespan, "lifespan is null");
         }
 
-        private void resetPositions(int positionCount)
+        private void resetPositions(int pagePositionCount)
         {
-            positions = ensureCapacity(positions, positionCount);
+            // Allocate positions array to at most 1024 initially to save memory
+            // It will grow if needed in addPosition
+            int initialCapacity = Math.min(pagePositionCount, 1024);
+            positions = ensureCapacity(positions, initialCapacity);
             this.positionCount = 0;
         }
 
         private void addPosition(int position)
         {
+            // Grow array if needed (by doubling current size or to at least positionCount)
+            if (positionCount >= positions.length) {
+                int newCapacity = Math.max(positions.length * 2, positionCount + 1);
+                positions = ensureCapacity(positions, newCapacity);
+            }
             positions[positionCount++] = position;
         }
 
