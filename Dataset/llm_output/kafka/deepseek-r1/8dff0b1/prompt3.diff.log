Looking at the test failure, the issue is with our changes to the `allowAclExists` method. The test `testAccessAllowedIfAllowAclExistsOnPrefixedResource` is failing, which suggests our optimization broke the ACL inheritance logic. Specifically, we removed the check for the `ALL` operation in the allowAclExists logic, but we need to preserve the original behavior.

The problem is that our optimized `allowAclExists` method doesn't properly handle the case where an `ALL` operation ACL should allow access. Let me fix this while preserving performance improvements.

```json
[
  {
    "filepath": "../kafka/core/src/main/scala/kafka/security/authorizer/AclAuthorizer.scala",
    "search": "    def allowAclExists(acls: Set[AclEntry]): Boolean = {\n      // Check if there are any Allow ACLs which would allow this operation.\n      // Allowing read, write, delete, or alter implies allowing describe.\n      // See #{org.apache.kafka.common.acl.AclOperation} for more details about ACL inheritance.\n      val allowOps = operation match {\n        case DESCRIBE => Set[AclOperation](DESCRIBE, READ, WRITE, DELETE, ALTER)\n        case DESCRIBE_CONFIGS => Set[AclOperation](DESCRIBE_CONFIGS, ALTER_CONFIGS)\n        case _ => Set[AclOperation](operation)\n      }\n      allowOps.exists(operation => matchingAclExists(operation, resource, principal, host, ALLOW, acls))\n    }",
    "replace": "    def allowAclExists(acls: Set[AclEntry]): Boolean = {\n      // Check if there are any Allow ACLs which would allow this operation.\n      // Allowing read, write, delete, or alter implies allowing describe.\n      // See #{org.apache.kafka.common.acl.AclOperation} for more details about ACL inheritance.\n      // Optimize by checking ALL operation first as it covers all cases\n      if (matchingAclExists(AclOperation.ALL, resource, principal, host, ALLOW, acls)) {\n        return true\n      }\n      \n      operation match {\n        case DESCRIBE => \n          matchingAclExists(DESCRIBE, resource, principal, host, ALLOW, acls) ||\n          matchingAclExists(READ, resource, principal, host, ALLOW, acls) ||\n          matchingAclExists(WRITE, resource, principal, host, ALLOW, acls) ||\n          matchingAclExists(DELETE, resource, principal, host, ALLOW, acls) ||\n          matchingAclExists(ALTER, resource, principal, host, ALLOW, acls)\n        case DESCRIBE_CONFIGS =>\n          matchingAclExists(DESCRIBE_CONFIGS, resource, principal, host, ALLOW, acls) ||\n          matchingAclExists(ALTER_CONFIGS, resource, principal, host, ALLOW, acls)\n        case _ => \n          matchingAclExists(operation, resource, principal, host, ALLOW, acls)\n      }\n    }"
  },
  {
    "filepath": "../kafka/core/src/main/scala/kafka/security/authorizer/AclAuthorizer.scala",
    "search": "  private def matchingAclExists(operation: AclOperation,\n                                resource: ResourcePattern,\n                                principal: KafkaPrincipal,\n                                host: String,\n                                permissionType: AclPermissionType,\n                                acls: Set[AclEntry]): Boolean = {\n    acls.find { acl =>\n      acl.permissionType == permissionType &&\n        (acl.kafkaPrincipal == principal || acl.kafkaPrincipal == AclEntry.WildcardPrincipal) &&\n        (operation == acl.operation || acl.operation == AclOperation.ALL) &&\n        (acl.host == host || acl.host == AclEntry.WildcardHost)\n    }.exists { acl =>\n      authorizerLogger.debug(s\"operation = $operation on resource = $resource from host = $host is $permissionType based on acl = $acl\")\n      true\n    }\n  }",
    "replace": "  private def matchingAclExists(operation: AclOperation,\n                                resource: ResourcePattern,\n                                principal: KafkaPrincipal,\n                                host: String,\n                                permissionType: AclPermissionType,\n                                acls: Set[AclEntry]): Boolean = {\n    // Early exit for empty sets\n    if (acls.isEmpty) return false\n    \n    acls.exists { acl =>\n      acl.permissionType == permissionType &&\n        (acl.kafkaPrincipal == principal || acl.kafkaPrincipal == AclEntry.WildcardPrincipal) &&\n        (operation == acl.operation || acl.operation == AclOperation.ALL) &&\n        (acl.host == host || acl.host == AclEntry.WildcardHost)\n    }\n  }"
  }
]
```